import{d as L,x as h,O as E,Q as F,V as A,U as J,v as g,K as v,L as $,$ as M,T as u,S as D,q as O,bs as H}from"./index.js";import{_ as V}from"./_plugin-vue_export-helper.js";import{g as k,a as x,U as l}from"./xivapi.js";const C=["innerHTML"],U={style:{padding:"0px 1px"}},P=L({__name:"timelineShow",props:{config:null,lines:null,runtime:null,showStyle:null},setup(e){const t=e;return(o,a)=>e.lines.length?(g(),h("ul",{key:0,class:"loadedTimelines",style:A(e.showStyle)},[(g(!0),h(E,null,F(t.lines,(n,r)=>v((g(),h("li",{key:r,class:M({upcoming:n.time-e.runtime<=e.config.discoloration,fade:n.time-e.runtime<=0-e.config.hold,passed:n.time-e.runtime<=0})},[u("aside",{style:A({right:Math.max((n.time-e.runtime)/e.config.displayDuration,0)*100+"%"})},null,4),u("section",null,[u("span",{innerHTML:n.actionHTML},null,8,C),u("span",U,D((n.time-e.runtime).toFixed(1)),1)])],2)),[[$,n.show&&n.time-e.runtime>0-e.config.hold-e.showStyle["--tras-duration"]&&n.time-e.runtime<=e.config.displayDuration]])),128))],4)):J("",!0)}});const ee=V(P,[["__scopeId","data-v-9ad68826"]]);var i=(e=>(e.显示范围="displayDuration",e.变色时间="discoloration",e.零后持续="hold",e.战前准备="preBattle",e.TTS提前量="ttsAdvance",e.刷新频率="refreshRateMs",e))(i||{});class R{constructor(t,o,a,n){l.iconToJobEnum(o.job)&&(o.job=l.jobEnumToJob(l.iconToJobEnum(o.job))),this.name=t,this.condition=o,this.timeline=a,this.codeFight=n,this.create=new Date().toLocaleString()}}const q={[i.显示范围]:"显示范围（秒）",[i.变色时间]:"提前变色（秒）",[i.零后持续]:"后续保持（秒）",[i.战前准备]:"倒计时量（秒）",[i.TTS提前量]:"TTS预备（秒）",[i.刷新频率]:"刷新率（毫秒）"},K={[i.显示范围]:120,[i.变色时间]:2.75,[i.零后持续]:.5,[i.战前准备]:30,[i.TTS提前量]:1,[i.刷新频率]:100},Q={"--timeline-width":"时间轴宽度","--font-size":"字体大小","--normal-scale":"等待缩放","--up-coming-scale":"来临缩放","--opacity":"等待不透明度","--tras-duration":"动画时间"};let G={"--timeline-width":180,"--font-size":18,"--opacity":.33,"--normal-scale":.5,"--up-coming-scale":1,"--tras-duration":1};const te=O("timeline",{state:()=>({allTimelines:[],configValues:K,configTranslate:q,settings:{api:""},filters:{},showStyle:G,showStyleTranslate:Q}),getters:{},actions:{newTimeline(e="Demo",t={zoneId:"0",job:"NONE"},o=`# 注释的内容不会被解析
# "<技能名>"会被解析为图片 紧接着一个波浪线可快捷重复技能名
-20 "<中间学派>~刷盾"
0 "战斗开始" tts "冲呀"
# 当sync在window的范围内被满足时将进行时间同步
30 "一运" sync / 14:4.{7}:[^:]*:AAAA:/ window 2.5,2.5
# 当存在jump时会进跳转至jump时间
50 "变异化型:蛇" sync / 14:4.{7}:[^:]*:BBBB:/ window 2.5,2.5 jump 1000
50 "变异化型:兽" sync / 14:4.{7}:[^:]*:CCCC:/ window 2.5,2.5 jump 2000
1000 "蛇轴"
2000 "兽轴"
`,a="用户创建"){this.allTimelines.push(new R(e,t,o,a)),this.sortTimelines(),H.fire({position:"center",icon:"success",title:`“${e}”已创建`,showConfirmButton:!1,timer:1e3})},getTimeline(e){return this.allTimelines.filter(t=>(t.condition.zoneId==="0"||t.condition.zoneId===e.zoneId)&&(t.condition.job==="NONE"||t.condition.job===e.job))},saveTimelineSettings(){localStorage.setItem("timelines",JSON.stringify({allTimelines:this.allTimelines,configValues:this.configValues,settings:this.settings,showStyle:this.showStyle,filters:this.filters}))},loadTimelineSettings(){const e=localStorage.getItem("timelines");e&&(Object.assign(this,JSON.parse(e)),this.allTimelines.forEach(t=>{t.condition.jobList&&(t.condition.job=t.condition.jobList[0]??"NONE",delete t.condition.jobList)}),this.sortTimelines()),this.allTimelines.forEach(t=>{l.iconToJobEnum(t.condition.job)&&(t.condition.job=l.jobEnumToJob(l.iconToJobEnum(t.condition.job)))})},sortTimelines(){this.allTimelines.sort((e,t)=>Number(e.condition.zoneId)===Number(t.condition.zoneId)?l.jobToJobEnum(e.condition.job)-l.jobToJobEnum(t.condition.job):Number(e.condition.zoneId)-Number(t.condition.zoneId))}}});function W(e){var o;const t=e.match(/^(?<negative>-)?(?<mm>[^:：]+):(?<ss>[^:：]+)$/);return t?parseFloat(t.groups.mm)*60+parseFloat(t.groups.ss)*((o=t.groups)!=null&&o.negative?-1:1):parseFloat(e)}function N(e){return e.matchAll(/\<(?<name>[^\<\>]*?)!??\>(?<repeat>~)?/g)}async function X(e){var o,a;e=e.replaceAll(/^["']|["']$/g,"");const t=N(e);if(!t)return Promise.resolve(e);for(const n of t)if((o=n.groups)!=null&&o.name){const r=await k(await x(n.groups.name).then(c=>(c==null?void 0:c.Icon)??""));e=e.replace(n[0],`${r?`<div class="skill_icon"><img src='${r}'/></div>`:""}${(a=n.groups)!=null&&a.repeat?n.groups.name:""}`)}return Promise.resolve(e)}async function ne(e){var a,n,r,c,f,p,w,T,y;const t=[],o=[...e.matchAll(/^(?<time>[-:：\d.]+)\s+(?<action>(--|["'])[^"'\n]+?\3).*$/gm)];for(let m=0;m<o.length;m++){const s=o[m],b=(a=s[0].match(new RegExp("(?<=jump )[-:：\\d.]+")))==null?void 0:a[0],d=(n=s[0].match(new RegExp("(?<=sync \\/).+(?=\\/)")))==null?void 0:n[0],S=(r=s[0].match(new RegExp("(?<=window )[-:：\\d.]+")))==null?void 0:r[0],j=(c=s[0].match(new RegExp("(?<=window [-:：\\d.]+,)[-:：\\d.]+")))==null?void 0:c[0],I=(p=(f=s[0].match(/ tts ["'](?<tts>[^"']+)["']/))==null?void 0:f.groups)==null?void 0:p.tts,z=/ tts(?: |$)/.test(s[0])?(y=(T=(w=Array.from(N(s.groups.action)))==null?void 0:w[0])==null?void 0:T.groups)==null?void 0:y.name:void 0,B=await X(s.groups.action);t.push({time:W(s.groups.time),actionHTML:s.groups.action?B:"",alertAlready:!1,sync:d?new RegExp(d):void 0,show:!d,windowBefore:parseFloat(S||j||"2.5"),windowAfter:parseFloat(j||S||"2.5"),jump:b?parseFloat(b):void 0,tts:I||z})}return t.sort((m,s)=>m.time-s.time),t}export{ee as _,ne as p,te as u};
